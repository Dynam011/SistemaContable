import{a as o,j as e}from"./index-DSdF_8M_.js";import{C as te,a as ae}from"./CCardBody-BViMqAMN.js";import{C as ne}from"./CCardHeader-CHF9S75-.js";import{a as u}from"./CButton-BjMrz52_.js";import{C as p}from"./CFormSelect-D_w2R_Sd.js";import{C as se,a as q}from"./CInputGroupText-DS5TEAvR.js";import{a as j,C as le}from"./CFormInput-2li5QlXf.js";import{C as N,a as k,b as d,c as l,d as E,e as s}from"./CTable-Dgqh94m4.js";import{C as w}from"./cil-people-krF7It8S.js";import{C as R,a as $,b as U,c as G}from"./CModalHeader-DDDsM_3D.js";import"./DefaultLayout-CeamR_9I.js";import"./index.esm-C4RaOWCk.js";const oe=[{id:1,nombre:"Cliente Uno"},{id:2,nombre:"Cliente Dos"},{id:3,nombre:"Cliente Tres"}],re=[{id:1,nombre:"Papa Negra"},{id:2,nombre:"Papa Blanca"},{id:3,nombre:"Papa Criolla"}],ie=[{id:1,cliente_id:1,cliente:"Cliente Uno",fecha_venta:"2025-07-07 12:00",total_venta:2500,estado_venta:"Completada",detalle:[{id:1,venta_id:1,producto_id:1,producto:"Papa Negra",cantidad:10,precio_unitario_venta:100,subtotal:1e3},{id:2,venta_id:1,producto_id:2,producto:"Papa Blanca",cantidad:15,precio_unitario_venta:100,subtotal:1500}]},{id:2,cliente_id:2,cliente:"Cliente Dos",fecha_venta:"2025-07-06 17:30",total_venta:1200,estado_venta:"Pendiente",detalle:[{id:3,venta_id:2,producto_id:3,producto:"Papa Criolla",cantidad:12,precio_unitario_venta:100,subtotal:1200}]}],de={Pendiente:"warning",Completada:"success",Cancelada:"danger"},ge=()=>{const[m,P]=o.useState([]),[y,L]=o.useState([]),[A,Q]=o.useState([]),[J,C]=o.useState(!1),[K,F]=o.useState(!1),[z,O]=o.useState([]),[c,T]=o.useState({cliente_id:"",fecha_venta:"",total_venta:"",estado_venta:"Pendiente"}),[h,v]=o.useState([]),[_,V]=o.useState(""),[b,I]=o.useState(""),[f,B]=o.useState(""),[g,H]=o.useState("");o.useEffect(()=>{P(ie),L(oe),Q(re)},[]);const S=t=>{T({...c,[t.target.name]:t.target.value})},D=(t,a,n)=>{const r=h.map((i,x)=>x===t?{...i,[a]:n,subtotal:a==="cantidad"||a==="precio_unitario_venta"?(a==="cantidad"?n:i.cantidad||0)*(a==="precio_unitario_venta"?n:i.precio_unitario_venta||0):i.subtotal}:i);v(r)},X=()=>{v([...h,{producto_id:"",cantidad:"",precio_unitario_venta:"",subtotal:0}])},Y=t=>{v(h.filter((a,n)=>n!==t))},M=()=>h.reduce((t,a)=>t+Number(a.subtotal||0),0),Z=t=>{t.preventDefault();const a=y.find(r=>r.id===parseInt(c.cliente_id)),n=h.map((r,i)=>{const x=A.find(ee=>ee.id===parseInt(r.producto_id));return{id:i+1,venta_id:m.length+1,producto_id:parseInt(r.producto_id),producto:x?x.nombre:"",cantidad:parseInt(r.cantidad),precio_unitario_venta:parseFloat(r.precio_unitario_venta),subtotal:parseFloat(r.subtotal)}});P([...m,{id:m.length+1,cliente_id:parseInt(c.cliente_id),cliente:a?a.nombre:"",fecha_venta:c.fecha_venta,total_venta:M(),estado_venta:c.estado_venta,detalle:n}]),C(!1),T({cliente_id:"",fecha_venta:"",total_venta:"",estado_venta:"Pendiente"}),v([])},W=m.filter(t=>{const a=_?t.cliente_id===parseInt(_):!0,n=b?t.estado_venta===b:!0,r=t.fecha_venta.slice(0,10),i=f?r>=f:!0,x=g?r<=g:!0;return a&&n&&i&&x});return e.jsxs(te,{style:{background:"linear-gradient(135deg, #E6EBE0 60%, #36C9C6 100%)",border:"none",boxShadow:"0 2px 16px 0 #36C9C633"},children:[e.jsxs(ne,{className:"d-flex justify-content-between align-items-center",style:{background:"#ED6A5A",color:"#fff"},children:[e.jsx("h5",{className:"mb-0",style:{letterSpacing:1},children:"Ventas"}),e.jsx(u,{color:"light",style:{color:"#ED6A5A",fontWeight:"bold"},onClick:()=>C(!0),children:"+ Nueva Venta"})]}),e.jsxs(ae,{children:[e.jsxs("div",{className:"mb-4 d-flex flex-wrap gap-3 align-items-end",style:{background:"#F4F1BB",borderRadius:8,padding:16},children:[e.jsxs(p,{size:"sm",style:{maxWidth:200},label:"Cliente",value:_,onChange:t=>V(t.target.value),children:[e.jsx("option",{value:"",children:"Todos los clientes"}),y.map(t=>e.jsx("option",{value:t.id,children:t.nombre},t.id))]}),e.jsxs(p,{size:"sm",style:{maxWidth:150},label:"Estado",value:b,onChange:t=>I(t.target.value),children:[e.jsx("option",{value:"",children:"Todos los estados"}),e.jsx("option",{children:"Pendiente"}),e.jsx("option",{children:"Completada"}),e.jsx("option",{children:"Cancelada"})]}),e.jsxs(se,{size:"sm",style:{maxWidth:260},children:[e.jsx(q,{children:"Desde"}),e.jsx(j,{type:"date",value:f,onChange:t=>B(t.target.value)}),e.jsx(q,{children:"Hasta"}),e.jsx(j,{type:"date",value:g,onChange:t=>H(t.target.value)})]}),(_||b||f||g)&&e.jsx(u,{color:"secondary",size:"sm",variant:"outline",onClick:()=>{V(""),I(""),B(""),H("")},children:"Limpiar filtros"})]}),e.jsxs(N,{hover:!0,responsive:!0,bordered:!0,align:"middle",className:"shadow-sm",style:{background:"#fff",borderRadius:8},children:[e.jsx(k,{color:"light",children:e.jsxs(d,{children:[e.jsx(l,{children:"#"}),e.jsx(l,{children:"Cliente"}),e.jsx(l,{children:"Fecha"}),e.jsx(l,{children:"Total"}),e.jsx(l,{children:"Estado"}),e.jsx(l,{children:"Detalle"})]})}),e.jsxs(E,{children:[W.length===0&&e.jsx(d,{children:e.jsx(s,{colSpan:6,className:"text-center text-muted",children:"No hay ventas registradas con los filtros seleccionados."})}),W.map(t=>e.jsxs(d,{children:[e.jsx(s,{children:t.id}),e.jsx(s,{children:e.jsx(w,{color:"info",style:{fontSize:13,background:"#36C9C6",color:"#fff"},children:t.cliente})}),e.jsx(s,{children:e.jsx("span",{style:{fontFamily:"monospace",color:"#6c757d"},children:t.fecha_venta})}),e.jsx(s,{children:e.jsxs("span",{style:{color:"#ED6A5A",fontWeight:600},children:["$",t.total_venta.toFixed(2)]})}),e.jsx(s,{children:e.jsx(w,{color:de[t.estado_venta]||"secondary",children:t.estado_venta})}),e.jsx(s,{children:e.jsx(u,{color:"info",size:"sm",variant:"outline",onClick:()=>{O(t.detalle||[]),F(!0)},children:"Ver Detalle"})})]},t.id))]})]})]}),e.jsxs(R,{visible:J,onClose:()=>C(!1),size:"lg",children:[e.jsx($,{style:{background:"#ED6A5A",color:"#fff"},children:e.jsx("strong",{children:"Nueva Venta"})}),e.jsxs(le,{onSubmit:Z,children:[e.jsxs(U,{children:[e.jsxs(p,{label:"Cliente",name:"cliente_id",value:c.cliente_id,onChange:S,required:!0,children:[e.jsx("option",{value:"",children:"Seleccione cliente"}),y.map(t=>e.jsx("option",{value:t.id,children:t.nombre},t.id))]}),e.jsx(j,{className:"mt-2",type:"datetime-local",label:"Fecha de venta",name:"fecha_venta",value:c.fecha_venta,onChange:S,required:!0}),e.jsxs(p,{className:"mt-2",label:"Estado",name:"estado_venta",value:c.estado_venta,onChange:S,required:!0,children:[e.jsx("option",{children:"Pendiente"}),e.jsx("option",{children:"Completada"}),e.jsx("option",{children:"Cancelada"})]}),e.jsxs("div",{className:"mt-4 mb-2",children:[e.jsx("strong",{children:"Detalle de la venta"}),e.jsx(u,{color:"success",size:"sm",className:"ms-2",onClick:X,children:"+ Agregar producto"})]}),e.jsxs(N,{bordered:!0,small:!0,children:[e.jsx(k,{children:e.jsxs(d,{children:[e.jsx(l,{children:"Producto"}),e.jsx(l,{children:"Cantidad"}),e.jsx(l,{children:"Precio Unitario"}),e.jsx(l,{children:"Subtotal"}),e.jsx(l,{})]})}),e.jsxs(E,{children:[h.length===0&&e.jsx(d,{children:e.jsx(s,{colSpan:5,className:"text-center text-muted",children:"Agregue productos a la venta."})}),h.map((t,a)=>e.jsxs(d,{children:[e.jsx(s,{children:e.jsxs(p,{size:"sm",value:t.producto_id,onChange:n=>D(a,"producto_id",n.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Seleccione producto"}),A.map(n=>e.jsx("option",{value:n.id,children:n.nombre},n.id))]})}),e.jsx(s,{children:e.jsx(j,{size:"sm",type:"number",min:1,value:t.cantidad,onChange:n=>D(a,"cantidad",parseInt(n.target.value)||""),required:!0})}),e.jsx(s,{children:e.jsx(j,{size:"sm",type:"number",min:0,step:"0.01",value:t.precio_unitario_venta,onChange:n=>D(a,"precio_unitario_venta",parseFloat(n.target.value)||""),required:!0})}),e.jsx(s,{children:e.jsxs("span",{style:{color:"#ED6A5A",fontWeight:600},children:["$",t.subtotal?Number(t.subtotal).toFixed(2):"0.00"]})}),e.jsx(s,{children:e.jsx(u,{color:"danger",size:"sm",variant:"outline",onClick:()=>Y(a),children:"Quitar"})})]},a))]})]}),e.jsxs("div",{className:"text-end mt-2",children:[e.jsx("strong",{children:"Total: "}),e.jsxs("span",{style:{color:"#36C9C6",fontWeight:700,fontSize:18},children:["$",M().toFixed(2)]})]})]}),e.jsxs(G,{children:[e.jsx(u,{color:"secondary",onClick:()=>C(!1),children:"Cancelar"}),e.jsx(u,{color:"primary",type:"submit",disabled:h.length===0,children:"Guardar"})]})]})]}),e.jsxs(R,{visible:K,onClose:()=>F(!1),children:[e.jsx($,{style:{background:"#36C9C6",color:"#fff"},children:e.jsx("strong",{children:"Detalle de la Venta"})}),e.jsx(U,{children:e.jsxs(N,{bordered:!0,small:!0,children:[e.jsx(k,{children:e.jsxs(d,{children:[e.jsx(l,{children:"Producto"}),e.jsx(l,{children:"Cantidad"}),e.jsx(l,{children:"Precio Unitario"}),e.jsx(l,{children:"Subtotal"})]})}),e.jsxs(E,{children:[z.length===0&&e.jsx(d,{children:e.jsx(s,{colSpan:4,className:"text-center text-muted",children:"Sin productos en esta venta."})}),z.map((t,a)=>e.jsxs(d,{children:[e.jsx(s,{children:t.producto}),e.jsx(s,{children:t.cantidad}),e.jsxs(s,{children:["$",Number(t.precio_unitario_venta).toFixed(2)]}),e.jsxs(s,{children:["$",Number(t.subtotal).toFixed(2)]})]},a))]})]})}),e.jsx(G,{children:e.jsx(u,{color:"secondary",onClick:()=>F(!1),children:"Cerrar"})})]})]})};export{ge as default};
