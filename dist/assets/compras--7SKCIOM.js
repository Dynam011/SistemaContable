import{a as d,j as e}from"./index-DSdF_8M_.js";import{C as oe,a as re}from"./CCardBody-BViMqAMN.js";import{C as ae}from"./CCardHeader-CHF9S75-.js";import{a as h}from"./CButton-BjMrz52_.js";import{C as m}from"./CFormSelect-D_w2R_Sd.js";import{C as se,a as w}from"./CInputGroupText-DS5TEAvR.js";import{a as x,C as te}from"./CFormInput-2li5QlXf.js";import{C as D,a as N,b as c,c as t,d as A,e as s}from"./CTable-Dgqh94m4.js";import{C as R}from"./cil-people-krF7It8S.js";import{C as $,a as G,b as V,c as U}from"./CModalHeader-DDDsM_3D.js";import"./DefaultLayout-CeamR_9I.js";import"./index.esm-C4RaOWCk.js";const de=[{id:1,nombre:"Proveedor A"},{id:2,nombre:"Proveedor B"}],le=[{id:1,nombre:"Papa Negra"},{id:2,nombre:"Papa Blanca"},{id:3,nombre:"Papa Criolla"}],ne=[{id:1,proveedor_id:1,proveedor:"Proveedor A",fecha_compra:"2025-07-07 10:00",total_compra:1500.5,estado_compra:"Pagada",detalle:[{id:1,compra_id:1,producto_id:1,producto:"Papa Negra",cantidad:10,precio_unitario_compra:100,subtotal:1e3},{id:2,compra_id:1,producto_id:2,producto:"Papa Blanca",cantidad:5,precio_unitario_compra:100.1,subtotal:500.5}]},{id:2,proveedor_id:2,proveedor:"Proveedor B",fecha_compra:"2025-07-06 15:30",total_compra:800,estado_compra:"Pendiente",detalle:[{id:3,compra_id:2,producto_id:3,producto:"Papa Criolla",cantidad:8,precio_unitario_compra:100,subtotal:800}]}],ce={Pendiente:"warning",Pagada:"success",Anulada:"danger"},fe=()=>{const[j,k]=d.useState([]),[y,L]=d.useState([]),[E,Q]=d.useState([]),[J,C]=d.useState(!1),[K,P]=d.useState(!1),[B,O]=d.useState([]),[i,z]=d.useState({proveedor_id:"",fecha_compra:"",total_compra:"",estado_compra:"Pendiente"}),[p,_]=d.useState([]),[b,T]=d.useState(""),[g,I]=d.useState(""),[v,H]=d.useState(""),[f,M]=d.useState("");d.useEffect(()=>{k(ne),L(de),Q(le)},[]);const F=o=>{z({...i,[o.target.name]:o.target.value})},S=(o,r,a)=>{const l=p.map((n,u)=>u===o?{...n,[r]:a,subtotal:r==="cantidad"||r==="precio_unitario_compra"?(r==="cantidad"?a:n.cantidad||0)*(r==="precio_unitario_compra"?a:n.precio_unitario_compra||0):n.subtotal}:n);_(l)},X=()=>{_([...p,{producto_id:"",cantidad:"",precio_unitario_compra:"",subtotal:0}])},Y=o=>{_(p.filter((r,a)=>a!==o))},W=()=>p.reduce((o,r)=>o+Number(r.subtotal||0),0),Z=o=>{o.preventDefault();const r=y.find(l=>l.id===parseInt(i.proveedor_id)),a=p.map((l,n)=>{const u=E.find(ee=>ee.id===parseInt(l.producto_id));return{id:n+1,compra_id:j.length+1,producto_id:parseInt(l.producto_id),producto:u?u.nombre:"",cantidad:parseInt(l.cantidad),precio_unitario_compra:parseFloat(l.precio_unitario_compra),subtotal:parseFloat(l.subtotal)}});k([...j,{id:j.length+1,proveedor_id:parseInt(i.proveedor_id),proveedor:r?r.nombre:"",fecha_compra:i.fecha_compra,total_compra:W(),estado_compra:i.estado_compra,detalle:a}]),C(!1),z({proveedor_id:"",fecha_compra:"",total_compra:"",estado_compra:"Pendiente"}),_([])},q=j.filter(o=>{const r=b?o.proveedor_id===parseInt(b):!0,a=g?o.estado_compra===g:!0,l=o.fecha_compra.slice(0,10),n=v?l>=v:!0,u=f?l<=f:!0;return r&&a&&n&&u});return e.jsxs(oe,{style:{background:"linear-gradient(135deg, #E6EBE0 60%, #9BC1BC 100%)",border:"none",boxShadow:"0 2px 16px 0 #9BC1BC33"},children:[e.jsxs(ae,{className:"d-flex justify-content-between align-items-center",style:{background:"#ED6A5A",color:"#fff"},children:[e.jsx("h5",{className:"mb-0",style:{letterSpacing:1},children:"Compras"}),e.jsx(h,{color:"light",style:{color:"#ED6A5A",fontWeight:"bold"},onClick:()=>C(!0),children:"+ Nueva Compra"})]}),e.jsxs(re,{children:[e.jsxs("div",{className:"mb-4 d-flex flex-wrap gap-2 align-items-end",style:{background:"#F4F1BB",borderRadius:8,padding:12},children:[e.jsxs(m,{size:"sm",style:{maxWidth:180},label:"Proveedor",value:b,onChange:o=>T(o.target.value),children:[e.jsx("option",{value:"",children:"Todos los proveedores"}),y.map(o=>e.jsx("option",{value:o.id,children:o.nombre},o.id))]}),e.jsxs(m,{size:"sm",style:{maxWidth:150},label:"Estado",value:g,onChange:o=>I(o.target.value),children:[e.jsx("option",{value:"",children:"Todos los estados"}),e.jsx("option",{children:"Pendiente"}),e.jsx("option",{children:"Pagada"}),e.jsx("option",{children:"Anulada"})]}),e.jsxs(se,{size:"sm",style:{maxWidth:500},children:[e.jsx(w,{children:"Desde"}),e.jsx(x,{type:"date",value:v,onChange:o=>H(o.target.value)}),e.jsx(w,{children:"Hasta"}),e.jsx(x,{type:"date",value:f,onChange:o=>M(o.target.value)})]}),(b||g||v||f)&&e.jsx(h,{color:"secondary",size:"sm",variant:"outline",onClick:()=>{T(""),I(""),H(""),M("")},children:"Limpiar filtros"})]}),e.jsxs(D,{hover:!0,responsive:!0,bordered:!0,align:"middle",className:"shadow-sm",style:{background:"#fff",borderRadius:8},children:[e.jsx(N,{color:"light",children:e.jsxs(c,{children:[e.jsx(t,{children:"#"}),e.jsx(t,{children:"Proveedor"}),e.jsx(t,{children:"Fecha"}),e.jsx(t,{children:"Total"}),e.jsx(t,{children:"Estado"}),e.jsx(t,{children:"Detalle"})]})}),e.jsxs(A,{children:[q.length===0&&e.jsx(c,{children:e.jsx(s,{colSpan:6,className:"text-center text-muted",children:"No hay compras registradas con los filtros seleccionados."})}),q.map(o=>e.jsxs(c,{children:[e.jsx(s,{children:o.id}),e.jsx(s,{children:e.jsx(R,{color:"info",style:{fontSize:13,background:"#36C9C6",color:"#fff"},children:o.proveedor})}),e.jsx(s,{children:e.jsx("span",{style:{fontFamily:"monospace",color:"#6c757d"},children:o.fecha_compra})}),e.jsx(s,{children:e.jsxs("span",{style:{color:"#ED6A5A",fontWeight:600},children:["$",o.total_compra.toFixed(2)]})}),e.jsx(s,{children:e.jsx(R,{color:ce[o.estado_compra]||"secondary",children:o.estado_compra})}),e.jsx(s,{children:e.jsx(h,{color:"info",size:"sm",variant:"outline",onClick:()=>{O(o.detalle||[]),P(!0)},children:"Ver Detalle"})})]},o.id))]})]})]}),e.jsxs($,{visible:J,onClose:()=>C(!1),size:"lg",children:[e.jsx(G,{style:{background:"#ED6A5A",color:"#fff"},children:e.jsx("strong",{children:"Nueva Compra"})}),e.jsxs(te,{onSubmit:Z,children:[e.jsxs(V,{children:[e.jsxs(m,{label:"Proveedor",name:"proveedor_id",value:i.proveedor_id,onChange:F,required:!0,children:[e.jsx("option",{value:"",children:"Seleccione proveedor"}),y.map(o=>e.jsx("option",{value:o.id,children:o.nombre},o.id))]}),e.jsx(x,{className:"mt-2",type:"datetime-local",label:"Fecha de compra",name:"fecha_compra",value:i.fecha_compra,onChange:F,required:!0}),e.jsxs("div",{className:"mt-4 mb-2",children:[e.jsx("strong",{children:"Detalle de la compra"}),e.jsx(h,{color:"success",size:"sm",className:"ms-2",onClick:X,children:"+ Agregar producto"})]}),e.jsxs(D,{bordered:!0,small:!0,children:[e.jsx(N,{children:e.jsxs(c,{children:[e.jsx(t,{children:"Producto"}),e.jsx(t,{children:"Cantidad"}),e.jsx(t,{children:"Precio Unitario"}),e.jsx(t,{children:"Subtotal"}),e.jsx(t,{})]})}),e.jsxs(A,{children:[p.length===0&&e.jsx(c,{children:e.jsx(s,{colSpan:5,className:"text-center text-muted",children:"Agregue productos a la compra."})}),p.map((o,r)=>e.jsxs(c,{children:[e.jsx(s,{children:e.jsxs(m,{size:"sm",value:o.producto_id,onChange:a=>S(r,"producto_id",a.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Seleccione producto"}),E.map(a=>e.jsx("option",{value:a.id,children:a.nombre},a.id))]})}),e.jsx(s,{children:e.jsx(x,{size:"sm",type:"number",min:1,value:o.cantidad,onChange:a=>S(r,"cantidad",parseInt(a.target.value)||""),required:!0})}),e.jsx(s,{children:e.jsx(x,{size:"sm",type:"number",min:0,step:"0.01",value:o.precio_unitario_compra,onChange:a=>S(r,"precio_unitario_compra",parseFloat(a.target.value)||""),required:!0})}),e.jsx(s,{children:e.jsxs("span",{style:{color:"#ED6A5A",fontWeight:600},children:["$",o.subtotal?Number(o.subtotal).toFixed(2):"0.00"]})}),e.jsx(s,{children:e.jsx(h,{color:"danger",size:"sm",variant:"outline",onClick:()=>Y(r),children:"Quitar"})})]},r))]})]}),e.jsxs("div",{className:"text-end mt-2",children:[e.jsx("strong",{children:"Total: "}),e.jsxs("span",{style:{color:"#36C9C6",fontWeight:700,fontSize:18},children:["$",W().toFixed(2)]})]}),e.jsxs(m,{className:"mt-2",label:"Estado",name:"estado_compra",value:i.estado_compra,onChange:F,required:!0,children:[e.jsx("option",{children:"Pendiente"}),e.jsx("option",{children:"Pagada"}),e.jsx("option",{children:"Anulada"})]})]}),e.jsxs(U,{children:[e.jsx(h,{color:"secondary",onClick:()=>C(!1),children:"Cancelar"}),e.jsx(h,{color:"primary",type:"submit",disabled:p.length===0,children:"Guardar"})]})]})]}),e.jsxs($,{visible:K,onClose:()=>P(!1),children:[e.jsx(G,{style:{background:"#36C9C6",color:"#fff"},children:e.jsx("strong",{children:"Detalle de la Compra"})}),e.jsx(V,{children:e.jsxs(D,{bordered:!0,small:!0,children:[e.jsx(N,{children:e.jsxs(c,{children:[e.jsx(t,{children:"Producto"}),e.jsx(t,{children:"Cantidad"}),e.jsx(t,{children:"Precio Unitario"}),e.jsx(t,{children:"Subtotal"})]})}),e.jsxs(A,{children:[B.length===0&&e.jsx(c,{children:e.jsx(s,{colSpan:4,className:"text-center text-muted",children:"Sin productos en esta compra."})}),B.map((o,r)=>e.jsxs(c,{children:[e.jsx(s,{children:o.producto}),e.jsx(s,{children:o.cantidad}),e.jsxs(s,{children:["$",Number(o.precio_unitario_compra).toFixed(2)]}),e.jsxs(s,{children:["$",Number(o.subtotal).toFixed(2)]})]},r))]})]})}),e.jsx(U,{children:e.jsx(h,{color:"secondary",onClick:()=>P(!1),children:"Cerrar"})})]})]})};export{fe as default};
